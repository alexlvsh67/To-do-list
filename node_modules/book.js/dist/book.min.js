var Book=function(t,e){var i=this;if(t.initializedBook)return i;i.options=e||{};for(var o=0;o<t.attributes.length;o++){var n=t.attributes[o];if(/^data-/.test(n.nodeName)){var s=n.nodeName.replace(/^data-/,"");i.options[s]=n.nodeValue}}if(!i.options.front)return i;i.transforms=i.are3dTransformsSupported(),i.inner=this.createElement("div","book-cover-inner");var r=1,a=0;return i.frontImage=i.createElement("img","book-cover-front-image",{src:i.options.front,alt:i.options.frontAlt||""}),i.transforms?(i.frontImage.onload=function(){++a===r&&i.calculateSizes()},i.front=i.createElement("div","book-cover-front"),i.frontOutside=i.createElement("div","book-cover-front-outside book-cover-overlay"),i.frontOutside.appendChild(i.frontImage),i.frontInside=i.createElement("div","book-cover-front-inside"),i.front.appendChild(i.frontOutside),i.front.appendChild(i.frontInside),i.inner.appendChild(i.front),i.back=i.createElement("div","book-cover-back book-cover-overlay"),i.inner.appendChild(i.back),i.left=i.createElement("div","book-cover-left"),i.inner.appendChild(i.left),i.right=i.createElement("div","book-cover-right"),i.inner.appendChild(i.right),i.top=i.createElement("div","book-cover-top"),i.inner.appendChild(i.top),i.bottom=i.createElement("div","book-cover-bottom"),i.inner.appendChild(i.bottom),i.options.back&&(r++,i.backImage=i.createElement("img","book-cover-back-image",{src:i.options.back,alt:i.options.backAlt||""}),i.backImage.onload=function(){++a===r&&i.calculateSizes()},i.back.appendChild(i.backImage)),i.options.spine&&(r++,i.spineImage=i.createElement("img","book-cover-spine-image",{src:i.options.spine,alt:i.options.spineAlt||""}),i.spineImage.onload=function(){++a===r&&i.calculateSizes()},i.left.appendChild(i.spineImage)),window.addEventListener("resize",i.debounce(function(){i.calculateSizes()},100))):(i.inner.appendChild(i.frontImage),i.inner.className+=" front"),i.element=t.cloneNode(),i.element.innerHTML="",i.element.appendChild(i.inner),i.element.initializedBook=!0,t.parentNode.replaceChild(i.element,t),i};Book.prototype.are3dTransformsSupported=function(){var t=document.createElement("div"),e=document.createElement("div");if(void 0===t.style.transform||void 0===t.style.transformStyle)return!1;t.style.transformStyle="preserve-3d",t.style.transform="rotate3d(0, 1, 0, 35deg)",e.style.transform="rotate3d(0, 1, 0, 90deg)",t.appendChild(e),document.body.appendChild(t);var i=e.getBoundingClientRect();return document.body.removeChild(t),0!==i.width},Book.prototype.createElement=function(t,e,i){var o=document.createElement(t);if(o.className=e,i)for(var n in i)o[n]=i[n];return o},Book.prototype.debounce=function(t,e){var i;return function(){clearTimeout(i);var o=this,n=arguments;i=setTimeout(function(){t.apply(o,n)},e)}},Book.prototype.calculateSizes=function(){this.inner.style.height="",this.front.style.height="",this.inner.style.width="",this.front.style.width="";var t=5,e=this.frontImage.offsetHeight,i=this.frontImage.offsetWidth;this.inner.style.height=e+"px",this.front.style.height=e+"px",this.back.style.height=e+"px",this.left.style.height=e+"px",this.right.style.height=e-2*t+2+"px",this.inner.style.width=i+"px",this.front.style.width=i+"px",this.back.style.width=i+"px",this.bottom.style.width=i-t+"px",this.top.style.width=i-t+"px";var o;this.spineImage?(this.left.style.width="auto",o=this.spineImage.offsetWidth):o=this.left.offsetWidth;var n=o/2;this.top.style.height=o-2+"px",this.bottom.style.height=o-2+"px",this.right.style.width=o-2+"px",this.left.style.width=o+"px",this.left.style.left=-n+"px",this.right.style.left=i-n-t+"px",this.top.style.top=-n+t+"px",this.bottom.style.top=e-n-t+"px",this.back.style.transform="rotate3d(0, 1, 0, -180deg) translate3d(0, 0, "+o+"px)",this.left.style.transform="rotate3d(0, 1, 0, -90deg) translate3d("+-n+"px, 0, 0)",this.right.style.transform="rotate3d(0, 1, 0, 90deg) translate3d("+n+"px, 0, 0)",this.top.style.transform="rotate3d(1, 0, 0, 90deg) translate3d(0, "+-n+"px, 0)",this.bottom.style.transform="rotate3d(1, 0, 0, -90deg) translate3d(0, "+n+"px, 0)",this.inner.style.transformOrigin="50% 50% "+-n+"px",this.activated||(/\bbook-cover/.test(this.element.className)||(this.element.className+=" book-cover"),/\activated/.test(this.element.className)||(this.element.className+=" activated"),this.element.className=this.element.className.trim(),this.activated=!0,this.inner.className+=" hover-ok"),this.spineImage.style.visibility="visible",this.backImage.style.visibility="visible"},Book.prototype.flip=function(){if(this.transforms){this.inner.className=this.inner.className.replace(/hover-ok/g,"").trim(),clearTimeout(this.timeout),/flipped/.test(this.inner.className)?this.inner.className=this.inner.className.replace(/flipped/g,"").trim():this.inner.className+=" flipped";var t=this;this.timeout=setTimeout(function(){t.inner.className+=" hover-ok"},500)}else this.options.back&&(/front/.test(this.inner.className)?(this.inner.className=this.inner.className.replace(/front/g,"back").trim(),this.frontImage.src=this.options.back,this.frontImage.alt=this.options.backAlt||""):(this.inner.className=this.inner.className.replace(/back/g,"front").trim(),this.frontImage.src=this.options.front,this.frontImage.alt=this.options.frontAlt||""))},"undefined"!=typeof jQuery&&(jQuery.fn.book=function(t){for(var e=[],i=0;i<this.length;i++)e.push(new Book(this[i],t));return 1===e.length?e[0]:e});