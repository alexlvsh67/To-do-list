var gulp = require('gulp');

var autoprefixer = require('gulp-autoprefixer');
var clean = require('gulp-clean-css');
var jshint = require('gulp-jshint');
var rename = require('gulp-rename');
var stylus = require('gulp-stylus');
var uglify = require('gulp-uglify');

// var version = '0.0.1';
// var banner =  "/* bloom.min.js ' + version + ' | 0x0049 | http://0x0049.link/book | MIT license */";
// built: date

gulp.task('lint', function () {
	return gulp.src('src/book.js')
		.pipe(jshint())
		.pipe(jshint.reporter('default'));
});

gulp.task('styles', function () {
	return gulp.src('src/book.styl')
		.pipe(stylus())
		.pipe(autoprefixer({
			browsers: ['last 2 version', 'ie 8', 'ie 9'],
			cascade: false,
			remove: false
		}))
		.pipe(gulp.dest('dist'))
		.pipe(rename('book.min.css'))
		.pipe(clean({
			compatibility: 'ie8'
		}))
		.pipe(gulp.dest('dist'));
});

gulp.task('scripts', ['lint'], function () {
	gulp.src('src/book.js')
		.pipe(gulp.dest('dist'))
		.pipe(rename('book.min.js'))
		.pipe(uglify())
		.pipe(gulp.dest('dist'));
});

gulp.task('watch', function () {
	gulp.watch('src/book.js', ['scripts']);
	gulp.watch('src/book.styl', ['styles']);
});

gulp.task('default', ['scripts', 'styles']);
